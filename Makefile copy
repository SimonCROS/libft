# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    Makefile                                           :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: scros <scros@student.42lyon.fr>            +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2020/11/23 11:39:11 by scros             #+#    #+#              #
#    Updated: 2020/12/13 16:16:54 by scros            ###   ########lyon.fr    #
#                                                                              #
# **************************************************************************** #

# Styles
_RESET		= \033[0m
_BOLD		= \033[1m
_UNDER		= \033[4m
_REV		= \033[7m

# Colors
_GREY		= \033[30m
_RED		= \033[31m
_GREEN		= \033[32m
_YELLOW		= \033[33m
_BLUE		= \033[34m
_PURPLE		= \033[35m
_CYAN		= \033[36m
_WHITE		= \033[37m

# Backgrounds
_IGREY		= \033[40m
_IRED		= \033[41m
_IGREEN		= \033[42m
_IYELLOW	= \033[43m
_IBLUE		= \033[44m
_IPURPLE	= \033[45m
_ICYAN		= \033[46m
_IWHITE		= \033[47m

BIN			= bin
SRC			= src
INC			= includes

CONV_SRCS	=	$(addprefix convert/,	\
				ft_atoi.c				\
				ft_atoi_len.c			\
				ft_itoa.c				\
				)

LIST_SRCS	=	$(addprefix list/,		\
				ft_lst_add_all.c		\
				ft_lst_clear.c			\
				ft_lst_destroy.c		\
				ft_lst_foreach.c		\
				ft_lst_get_entry.c		\
				ft_lst_is_empty.c		\
				ft_lst_last.c			\
				ft_lst_new.c			\
				ft_lst_pop.c			\
				ft_lst_set.c			\
				ft_lst_copy.c			\
				ft_lst_size.c			\
				ft_lst_map.c			\
				ft_lst_splice.c			\
				ft_lst_reduce.c			\
				ft_lst_concat.c			\
				ft_lst_shift_entry.c	\
				ft_lst_get.c			\
				ft_lst_remove.c			\
				ft_lst_insert.c			\
				ft_lst_last_entry.c		\
				ft_lst_new_entry.c		\
				ft_lst_push.c			\
				ft_lst_shift.c			\
				ft_lst_slice.c			\
				ft_lst_unshift.c		\
				)

MATH_SRCS	=	$(addprefix math/,		\
				ft_min.c				\
				ft_max.c				\
				)

MEMORY_SRCS	=	$(addprefix memory/,	\
				ft_bzero.c				\
				ft_calloc.c				\
				ft_memccpy.c			\
				ft_memchr.c				\
				ft_memcmp.c				\
				ft_memcpy.c				\
				ft_memmove.c			\
				ft_memset.c				\
				)

PRINT_SRCS	=	$(addprefix print/,		\
				ft_putchar_fd.c			\
				ft_putendl_fd.c			\
				ft_putnbr_fd.c			\
				ft_putstr_fd.c			\
				)

STRING_SRCS	=	$(addprefix string/,	\
				ft_isalnum.c			\
				ft_isalpha.c			\
				ft_isascii.c			\
				ft_isdigit.c			\
				ft_isprint.c			\
				ft_split.c				\
				ft_strchr.c				\
				ft_strdup.c				\
				ft_strindex_of.c		\
				ft_strjoin.c			\
				ft_strlcat.c			\
				ft_strlcpy.c			\
				ft_strlen.c				\
				ft_strmapi.c			\
				ft_strncmp.c			\
				ft_strnstr.c			\
				ft_strrchr.c			\
				ft_strtrim.c			\
				ft_substr.c				\
				ft_tolower.c			\
				ft_toupper.c			\
				)

UTIL_SRCS	=	$(addprefix util/,		\
				ft_identity.c			\
				)

SRCS		=	$(CONV_SRCS)			\
				$(LIST_SRCS)			\
				$(MATH_SRCS)			\
				$(MEMORY_SRCS)			\
				$(PRINT_SRCS)			\
				$(STRING_SRCS)			\
				$(UTIL_SRCS)			\


CONV_OBJS	= $(addprefix $(BIN)/, $(CONV_SRCS:.c=.o))
LIST_OBJS	= $(addprefix $(BIN)/, $(LIST_SRCS:.c=.o))
MATH_OBJS	= $(addprefix $(BIN)/, $(MATH_SRCS:.c=.o))
MEMORY_OBJS	= $(addprefix $(BIN)/, $(MEMORY_SRCS:.c=.o))
PRINT_OBJS	= $(addprefix $(BIN)/, $(PRINT_SRCS:.c=.o))
STRING_OBJS	= $(addprefix $(BIN)/, $(STRING_SRCS:.c=.o))
UTIL_OBJS	= $(addprefix $(BIN)/, $(UTIL_SRCS:.c=.o))

OBJS		= $(addprefix $(BIN)/, $(SRCS:.c=.o))

HEADERS		= $(addprefix $(INC)/, libft.h)

NAME		= libft.a

CC			= gcc
RM			= rm -rf

CFLAGS		= -Wall -Wextra -Werror

bar			= 0
compteur	= 0
compile		= 0
count		= $(words $(SRCS))

compile_code= tabs 6; \
			if [ $(bar) -eq 0 ]; then \
				echo "$$(($(compteur)*100/$(count)))%	$(_WHITE)\xE2\x9D\x96$(_RESET) $(_BLUE)Compiling source $(_GREEN)$< $(_BLUE)\xE2\x86\x92 $(_YELLOW)$@$(_RESET)\c"; \
			else \
				tput el; \
				if [ $$(($(compteur)*50/$(count))) -gt 0 ]; then \
					for i in $$(seq 1 $$(($(compteur)*50/$(count)))); do \
						str="$${str} "; \
					done; \
				fi; \
				str="$${str}$(_IWHITE)"; \
				if [ $$((50 - ($(compteur)*50/$(count)))) -gt 0 ]; then \
					for i in $$(seq 1 $$((50 - ($(compteur)*50/$(count))))); do \
						str="$${str} "; \
					done; \
				fi; \
				str="$${str}$(_RESET) $(_PURPLE)$$(($(compteur)*100/$(count)))% $(_GREEN)$< $(_BLUE)\xE2\x86\x92 $(_YELLOW)$@               	"; \
				str="$${str}$(_RESET)"; \
				echo "$$str"; \
			fi; \
			mkdir -p $(dir $@); \
			$(CC) $(CFLAGS) -c -o $@ $< -I $(INC); \
			if [ $(bar) -eq 0 ]; then \
				echo " $(_GREEN)\xE2\x9C\x93$(_RESET)"; \
			else \
				tput cuu1; \
			fi;

all:		$(NAME)

ball:		bar $(NAME)
			
bar:
			$(eval bar=1)

$(BIN)/%.o: $(SRC)/%.c $(HEADERS)
			$(eval compteur=$(shell echo $$(($(compteur)+1))))
			@str="$(_IGREEN)"; $(compile_code)

$(NAME):	$(HEADERS) pre_compile $(OBJS) post_compile
			@ar rc $(NAME) $(OBJS)

pre_compile:
			@echo "$(_BOLD)$(_CYAN)Compiling...$(_RESET)"
			@echo "\n"

compile:	$(CONV_OBJS) $(LIST_OBJS) $(MATH_OBJS) $(MEMORY_OBJS) $(PRINT_OBJS) $(STRING_OBJS) $(UTIL_OBJS)

post_compile:
			@echo "\n"
			@echo "$(_RED)Finished ! $(_RESET)($(_PURPLE)$(compteur)$(_RESET) files compiled)$(_RESET)"

clean:
			@echo "\xF0\x9F\x97\x91  $(_BOLD)$(_YELLOW)Deleting objects...$(_RESET)\n"
			@$(RM) $(OBJS)

fclean:		clean
			@echo "\xF0\x9F\x97\x91  $(_BOLD)$(_RED)Deleting $(NAME)$(_RESET)\n"
			@$(RM) $(NAME)

re:			fclean all

bre:		fclean ball

.PHONY:		all ball bar pre_compile post_compile clean fclean re bre
